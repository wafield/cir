{% extends 'base.html' %}
{% load static %}
{% load compressed %}
{% block extralib %}
    <script>
            require([
                'layout/layout'
            ]);
    </script>
{% endblock %}
{% block delaylib %}
{% endblock %}
{% block extracss %}
	{% compressed_css 'cir_forum' %}
{% endblock %}
{% block header %}
<div id="nav-menu" class="ui fixed inverted main menu">
    <a href="/" class="title item">{{ forum_name }}</a>
    {% if load_error %}
    <div class="item">GeoDeliberator</div>
    {% else %}
    <a href="#" class="blue item {{ settings.document_active }}" data-tab="document-tab"><i class="icon file text outline"></i>Documents</a>
    <a href="#" class="blue item {{ settings.claim_active }}" data-tab="claim-tab"><i class="icon comment outline"></i>Claims</a>
    {% if settings.phase == 'finished' %}
    <a href="{{ forum_url }}/statement" class="item">Citizens' Statement</a>
    {% endif %}
    <div id="header-visitor-wrapper" class="right menu" style="display:flex">
        <div class="item">
            <div id="login-btn" class="ui button">Log in</div>
        </div>
        <div class="item">
            <div id="signup-btn" class="ui button">Sign up</div>
        </div>
    </div>
    <div id="header-member-wrapper" class="right menu" style="display:flex">
        <a href="#" class="item"><i class="mail icon"></i>Messages</a>
        <div class="ui simple dropdown item" tabindex="0">
            <span id="header-user-name" data-id="{{ user_id }}" data-role="{{ role }}">{{ user_name }}</span>
            <i class="icon dropdown" tabindex="0"></i>
            <div class="menu" tabindex="-1">
                <a href="#" id="edit-profile-btn" class="item"><i class="edit icon"></i>Edit Profile</a>
                <a href="/" class="item"><i class="list layout icon"></i>Switch Forum</a>
                <a href="#" class="item"><i class="share alternative icon"></i>Share Forum</a>
                <a href="#" id="sign-out-btn" class="item"><i class="sign out icon"></i>Sign out</a>
            </div>
        </div>
    </div>
    <div id="header-facilitator-wrapper" class="right menu" style="display:flex">
        <a href="{{ forum_url }}/dashboard" class="item">
            <i class="icon dashboard"></i>
        </a>
        <div class="ui simple dropdown item" tabindex="0">
            <i class="icon spy"></i>
            <i class="icon dropdown" tabindex="0"></i>
            <div class="switch user menu" tabindex="-1">
                <div class="header">Yourself</div>
                <div class="item" data-id="{{ user_id }}">{{ user_name }}</div>
                <div class="header">Panelists</div>
                {% for user in panelists %}
                <div class="item" data-id="{{ user.id }}">{{ user.name }}</div>
                {% endfor %}
                <div class="header">Staff</div>
                {% for user in staff %}
                <div class="item" data-id="{{ user.id }}">{{ user.name }}</div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block body %}
<div id="popup-notification" class="ui message hidden"></div>
	{% if load_error %}
		{% if load_error == '404' %}
<div class="ui two column centered grid">
	<div class="column" style="top:50px">
		<div class="ui error message">
			<div class="header">Forum does not exist; did you enter the correct address?</div>
			<p>Click <a href="/">here</a> to return to homepage.</p>
		</div>
	</div>
</div>
		{% elif load_error == '403' %}
<div class="ui two column centered grid">
	<div class="column" style="top:50px">
		<div class="ui error message">
			<div class="header">Sorry, this is a private forum</div>
			<ul class="list">
				<li>This forum is only accessible to specific users.</li>
				<li>Click <a href="/">here</a> to return to homepage.</li>
			</ul>
		</div>
	</div>
</div>
		{% endif %}
	{% else %}
<div class="ui main tab {{ settings.document_active }}" data-tab="document-tab">
	<div class="ui grid">
		<div class="sixteen wide column" style="padding-top:1em">
			<div class="ui attached info message">
				<div class="ui instructions accordion">
					<div class="ui active title"><i class="dropdown icon"></i>Current phase: {{ settings.phase_full }}</div>
					<div class="active content">
						{% if settings.phase == 'not_started' %}
							The deliberation is not started yet. Further instructions will be updated here!
						{% elif settings.phase == 'extract' %}
							You'll be working on ... Please ... This process will last ...
						{% elif settings.phase == 'categorize' %}
							You'll be working on ... Please ... This process will last ...
						{% elif settings.phase == 'theming' %}
							You'll be working on ... Please ... This process will last ...
						{% elif settings.phase == 'improve' %}
							You'll be working on ... Please ... This process will last ...
						{% elif settings.phase == 'finished' %}
							The deliberation event has ended. Please view the statement.
						{% elif settings.phase == 'paused' %}
							The deliberation process is temporarily paused.
						{% endif %}
					</div>
				</div>
			</div>
			<div id="document-categories" class="ui attached segment"></div>
		</div>
		<div class="ten wide column" style="padding-top:0">
			<div id="document-pane" class="ui segment">Please select a document from the list.</div>
		</div>
		<div class="six wide column"></div>
	</div>
	<div id="doc-highlight-toolbar">
	{% if settings.phase == 'extract' %}
		<div class="ui attached top segment blue labeled icon menu">
			<a data-action="comment" class="item doc-anno-btn">
			    <i class="comment icon"></i>Comment
			</a>
			<a data-action="question" class="item doc-anno-btn">
			    <i class="help icon"></i>Raise question
			</a>
			<a data-action="claim" class="item doc-anno-btn">
			    <i class="code icon"></i>Extract claim
			</a>
		</div>
		<div class="ui attached bottom segment" style="display:none">
			<form id="doc-comment-form" class="ui form comment" style="display:none">
				<div class="field">
					<label><span></span> (Ctrl + Enter to publish)</label>
					<textarea rows="2"></textarea>
				</div>
				<div class="ui primary button doc-anno-submit">Publish</div>
			</form>
			<form id="doc-claim-form" class="ui form claim" style="display:none">
				<div class="field">
					<div class="ui attached info message">Please reword the highlighted text to form a coherent and meaningful claim.</div>
					<textarea></textarea>
				</div>
				<div class="ui checkbox nopublish-wrapper">
					<label>Save for later</label>
					<input type="checkbox" name="nopublish">
				</div>
				<div class="ui primary button doc-anno-submit">Publish</div>
			</form>
		</div>
	{% else %}
		<div class="ui warning message">
			We are not in a claim extraction round. You can only work on existing highlights.
		</div>
	{% endif %}
	</div>
	{% include 'doc-thread-popup.html' with settings=settings %}
</div>
<div class="ui main tab {{ settings.claim_active }}" data-tab="claim-tab">
	<div class="ui grid">
		<div class="ten wide column" style="margin-bottom: 3em">
            <div class="ui attached info message" style="margin-top:0">
                <div class="ui instructions accordion">
                    <div class="ui active title"><i class="dropdown icon"></i>Current phase: {{ settings.phase_full }}</div>
                    <div class="active content">
                        {% if settings.phase == 'not_started' %}
                            The deliberation is not started yet. Further instructions will be updated here!
                        {% elif settings.phase == 'extract' %}
                            You'll be working on ... Please ... This process will last ...
                        {% elif settings.phase == 'categorize' %}
                            You'll be working on ... Please ... This process will last ...
                        {% elif settings.phase == 'theming' %}
                            You'll be working on ... Please ... This process will last ...
                        {% elif settings.phase == 'improve' %}
                            You'll be working on ... Please ... This process will last ...
                        {% elif settings.phase == 'finished' %}
                            The deliberation event has ended. Please view the statement.
                        {% elif settings.phase == 'paused' %}
                            The deliberation process is temporarily paused.
                        {% endif %}
                    </div>
                </div>
            </div>
			<div class="ui menu" style="margin:0 -1px;border:none">
				<a class="blue item active claim-view-btn" data-type="overview">
					<i class="align justify icon"></i> Overview
				</a>
				<a class="blue item claim-view-btn" data-type="fullscreen">
					<i class="maximize icon"></i> Full-screen Review
				</a>
			</div>

			<div id="claim-pane" class="{{ settings.phase }}">
				<div class="ui segment" style="height: 10em;"></div>
			</div>
		</div>
		<div id="claim-navigator" class="six wide column"></div>
		<div id="claim-merge-editor" class="ui modal">
			<i class="close icon"></i>
			<div class="content">
				<form class="ui form">
					<h4 class="ui dividing header">You are merging the following claims:</h4>
					<input type="hidden" />
					<div class="claim-content"></div>
					<textarea class="claim editor" rows="6"></textarea>
					<div class="ui primary button">Submit</div>
					<div class="ui close button">Discard</div>
				</form>
			</div>
		</div>
		<div id="claim-reason-editor" class="ui modal">
			<i class="close icon"></i>
			<div class="content">
				<form class="ui form">
					<h4 class="ui dividing header">Please input a reason for the suggested operation (optional):</h4>
					<input type="hidden" name="version_id" />
					<input type="hidden" name="collective" />
					<div class="reason-content"></div>
					<textarea class="reason editor" rows="3" placeholder="Reason (optional)"></textarea>
					<div class="ui primary button">Submit</div>
					<div class="ui close button">Cancel</div>
				</form>
			</div>
		</div>
	</div>

	<div class="ui five steps" style="position:fixed;bottom:0;left:0">
		<div class="{% if settings.phase == 'extract' %}active {% endif %}step">
			<div class="title">Extract</div>
		</div>
		<div class="{% if settings.phase == 'categorize' %}active {% endif %}step">
			<div class="title">Categorize</div>
		</div>
		<div class="{% if settings.phase == 'theme' %}active {% endif %}step">
			<div class="title">Identify Themes</div>
		</div>
		<div class="{% if settings.phase == 'improve' %}active {% endif %}step">
			<div class="title">Prioritize &amp; Improve</div>
		</div>
		<div class="{% if settings.phase == 'finished' %}active {% endif %}step">
		{% if settings.phase == 'finished' %}
			<a href="{{ forum_url }}/statement" class="title">Citizens' Statement</a>
		{% else %}
			<div class="title">Citizens' Statement</div>
		{% endif %}
		</div>
	</div>
</div>
	{% endif %}
{% endblock %}